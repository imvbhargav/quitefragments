---
import Layout from "../../layouts/Layout.astro";
import ShareButton from "../../components/ShareButton.astro";
import { getEntry, render } from "astro:content";

const { id } = Astro.params;
const post = await getEntry("fragments", id);

if (!post) {
    throw new Error(`Post not found: ${id}`);
}

const { Content } = await render(post);
const ogImage = `/og-image/${encodeURIComponent(post.data.title)}.png`;
---

<Layout
    title={post.data.title}
    description={post.data.description}
    date={post.data.date.toISOString()}
    ogImage={ogImage}
>
    <article
        class="prose max-w-none prose-blockquote:border-acclight/50 dark:prose-blockquote:border-accdark/50 prose-blockquote:text-fglight dark:prose-blockquote:text-fgdark prose-headings:text-fglight dark:prose-headings:text-fgdark md:prose-lg lg:prose-xl prose-h1:text-3xl md:prose-h1:text-4xl lg:prose-h1:text-5xl prose-slate text-fglight dark:text-fgdark dark:prose-invert divide-y-2 divide-acclight/50 dark:divide-accdark/50"
    >
        <div class="py-6 px-2 lg:px-12">
            <p
                style={`view-transition-name: date-${post.id}`}
                class="text-fglight/50 dark:text-fgdark/50"
            >
                <em>{post.data.date.toDateString()}</em>
            </p>
            <h1
                class="text-fglight dark:text-fgdark"
                style={`view-transition-name: ${post.id}`}
            >
                {post.data.title}
            </h1>
        </div>

        <div class="py-6 px-2 lg:px-12">
            <Content />
        </div>

        <ShareButton
            title={post.data.title}
            description={post.data.description}
            url={Astro.url.href}
        />
    </article>
</Layout>
